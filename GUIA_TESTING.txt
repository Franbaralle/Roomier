â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    GUÃA DE TESTING - ROOMIER
                Pruebas de Mejoras CrÃ­ticas Implementadas
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha: 31 de Diciembre de 2025

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ğŸ§ª CONFIGURACIÃ“N INICIAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Iniciar MongoDB:
   - MongoDB debe estar corriendo en localhost:27017

2. Iniciar Backend:
   > cd backend
   > node app.js
   
   âœ“ Debe mostrar: "Conexion a MongoDB establecida con exito"
   âœ“ Backend corriendo en http://localhost:3000

3. Iniciar Flutter:
   > flutter run -d chrome
   
   âœ“ App debe abrir en Chrome


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ” PRUEBA 1: HASHING DE CONTRASEÃ‘AS (BCRYPT)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Verificar que las contraseÃ±as se almacenan hasheadas

PASOS:
1. Crear un nuevo usuario desde la app
   - Usuario: test_security_01
   - Email: test@security.com
   - ContraseÃ±a: Password123!

2. Verificar en MongoDB:
   > mongo
   > use flutter_auth
   > db.users.findOne({username: "test_security_01"})

RESULTADO ESPERADO:
âœ“ El campo "password" debe empezar con "$2b$" o "$2a$"
âœ“ La contraseÃ±a NO debe ser "Password123!" en texto plano
âœ“ Ejemplo vÃ¡lido: "$2b$10$iHKJDKJFkjdfkj3k4j5k6..."

RESULTADO INVÃLIDO:
âœ— Si el password es "Password123!" (texto plano)
âœ— Si el password es legible


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ« PRUEBA 2: JWT TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Verificar que se generan tokens JWT correctamente

PASOS CON LA APP:
1. Hacer login con un usuario existente
2. Abrir DevTools (F12) â†’ Network
3. Observar la respuesta del endpoint /api/auth/login

RESULTADO ESPERADO:
âœ“ Respuesta debe incluir campo "token"
âœ“ Token tiene formato: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ..."
âœ“ Respuesta incluye "username" y "email"

PRUEBA CON CURL:
> curl -X POST http://localhost:3000/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test_security_01\",\"password\":\"Password123!\"}"

RESULTADO ESPERADO:
{
  "message": "Inicio de sesiÃ³n exitoso",
  "token": "eyJhbGci...",
  "username": "test_security_01",
  "email": "test@security.com"
}

VERIFICAR EXPIRACIÃ“N DEL TOKEN:
- El token debe tener expiraciÃ³n de 24 horas
- Decodificar en https://jwt.io para verificar payload


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        â±ï¸ PRUEBA 3: RATE LIMITING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OBJETIVO: Verificar que los limitadores de tasa funcionan

PRUEBA 3A: RATE LIMIT EN LOGIN
--------------------------------
PASOS:
1. Intentar login con contraseÃ±a incorrecta 6 veces seguidas

CURL (ejecutar 6 veces):
> curl -X POST http://localhost:3000/api/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test\",\"password\":\"wrong\"}"

RESULTADO ESPERADO:
âœ“ Intentos 1-5: Error 401 "Usuario o contraseÃ±a invÃ¡lidos"
âœ“ Intento 6: Error 429 "Demasiados intentos de inicio de sesiÃ³n"
âœ“ Mensaje: "Has excedido el nÃºmero de intentos..."
âœ“ Headers incluyen: RateLimit-Limit, RateLimit-Remaining

PRUEBA 3B: RATE LIMIT EN REGISTRO
----------------------------------
PASOS:
1. Intentar registrar 4 usuarios diferentes en menos de 1 hora

CURL (ejecutar 4 veces con diferentes usernames):
> curl -X POST http://localhost:3000/api/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test1\",\"password\":\"pass\",\"email\":\"t1@t.com\",\"birthdate\":\"2000-01-01\"}"

> curl -X POST http://localhost:3000/api/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test2\",\"password\":\"pass\",\"email\":\"t2@t.com\",\"birthdate\":\"2000-01-01\"}"

> curl -X POST http://localhost:3000/api/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test3\",\"password\":\"pass\",\"email\":\"t3@t.com\",\"birthdate\":\"2000-01-01\"}"

> curl -X POST http://localhost:3000/api/auth/register ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test4\",\"password\":\"pass\",\"email\":\"t4@t.com\",\"birthdate\":\"2000-01-01\"}"

RESULTADO ESPERADO:
âœ“ Intentos 1-3: Success (201)
âœ“ Intento 4: Error 429 "Demasiados registros"

PRUEBA 3C: RATE LIMIT EN CAMBIO DE CONTRASEÃ‘A
----------------------------------------------
PASOS:
1. Intentar cambiar contraseÃ±a 4 veces en 1 hora

CURL (ejecutar 4 veces):
> curl -X PUT http://localhost:3000/api/auth/update-password/test ^
  -H "Content-Type: application/json" ^
  -d "{\"newPassword\":\"NewPass123\"}"

RESULTADO ESPERADO:
âœ“ Intentos 1-3: Success o Error
âœ“ Intento 4: Error 429 "Demasiados intentos"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸš« PRUEBA 4: SISTEMA DE REPORTES Y BLOQUEO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PREPARACIÃ“N:
1. Crear 2 usuarios de prueba:
   - Usuario A: reportTest01
   - Usuario B: reportTest02
2. Hacer login con ambos (obtener tokens)

PRUEBA 4A: REPORTAR USUARIO
----------------------------
PASOS:
1. Usuario A reporta a Usuario B

CURL:
> curl -X POST http://localhost:3000/api/moderation/report ^
  -H "Content-Type: application/json" ^
  -H "Authorization: Bearer {TOKEN_USUARIO_A}" ^
  -d "{\"reportedUser\":\"reportTest02\",\"reason\":\"harassment\",\"description\":\"Comportamiento inapropiado\"}"

RESULTADO ESPERADO:
âœ“ Status: 201 Created
âœ“ Mensaje: "Reporte enviado exitosamente..."
âœ“ Incluye reportId

VERIFICAR EN MONGO:
> db.reports.find({reportedUser: "reportTest02"})

âœ“ Debe existir el reporte
âœ“ Status: "pending"
âœ“ Reason: "harassment"

CASOS DE ERROR A PROBAR:
1. Reportar sin token:
   âœ“ Error 401 "Acceso denegado"

2. Auto-reportarse:
   > curl -X POST http://localhost:3000/api/moderation/report ^
     -H "Authorization: Bearer {TOKEN}" ^
     -d "{\"reportedUser\":\"reportTest01\",\"reason\":\"spam\"}"
   
   âœ“ Error 400 "No puedes reportarte a ti mismo"

3. Reportar mismo usuario dos veces:
   âœ“ Error 400 "Ya has reportado a este usuario anteriormente"

4. Reportar usuario inexistente:
   âœ“ Error 404 "El usuario que intentas reportar no existe"

PRUEBA 4B: BLOQUEAR USUARIO
----------------------------
PASOS:
1. Usuario A bloquea a Usuario B

CURL:
> curl -X POST http://localhost:3000/api/moderation/block ^
  -H "Content-Type: application/json" ^
  -H "Authorization: Bearer {TOKEN_USUARIO_A}" ^
  -d "{\"blockedUser\":\"reportTest02\"}"

RESULTADO ESPERADO:
âœ“ Status: 200 OK
âœ“ Mensaje: "Usuario bloqueado exitosamente"
âœ“ Retorna lista actualizada de blockedUsers

VERIFICAR EN MONGO:
> db.users.findOne({username: "reportTest01"}, {blockedUsers: 1})

âœ“ blockedUsers debe incluir "reportTest02"

PRUEBA 4C: USUARIO BLOQUEADO NO APARECE EN HOME
------------------------------------------------
PASOS:
1. Usuario A hace request a /api/home

CURL:
> curl http://localhost:3000/api/home?currentUser=reportTest01

RESULTADO ESPERADO:
âœ“ La lista NO debe incluir "reportTest02"
âœ“ Usuario bloqueado filtrado correctamente

PRUEBA 4D: DESBLOQUEAR USUARIO
-------------------------------
CURL:
> curl -X POST http://localhost:3000/api/moderation/unblock ^
  -H "Content-Type: application/json" ^
  -H "Authorization: Bearer {TOKEN_USUARIO_A}" ^
  -d "{\"unblockedUser\":\"reportTest02\"}"

RESULTADO ESPERADO:
âœ“ Status: 200 OK
âœ“ Mensaje: "Usuario desbloqueado exitosamente"
âœ“ blockedUsers ya no incluye "reportTest02"

PRUEBA 4E: OBTENER LISTA DE BLOQUEADOS
---------------------------------------
CURL:
> curl http://localhost:3000/api/moderation/blocked ^
  -H "Authorization: Bearer {TOKEN}"

RESULTADO ESPERADO:
âœ“ Status: 200 OK
âœ“ Retorna array de usernames bloqueados

PRUEBA 4F: OBTENER MIS REPORTES
--------------------------------
CURL:
> curl http://localhost:3000/api/moderation/my-reports ^
  -H "Authorization: Bearer {TOKEN}"

RESULTADO ESPERADO:
âœ“ Status: 200 OK
âœ“ Lista de reportes hechos por el usuario
âœ“ Incluye: reportedUser, reason, description, status, createdAt


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ“œ PRUEBA 5: TÃ‰RMINOS Y POLÃTICA DE PRIVACIDAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASOS:
1. Abrir la app en Chrome
2. En la pÃ¡gina de login, hacer scroll hasta abajo
3. Verificar que existen dos links

PRUEBA 5A: TÃ‰RMINOS Y CONDICIONES
----------------------------------
1. Click en "TÃ©rminos y Condiciones"

RESULTADO ESPERADO:
âœ“ Navega a pÃ¡gina de tÃ©rminos
âœ“ Muestra 14 secciones numeradas
âœ“ Incluye fecha: "31 de Diciembre de 2025"
âœ“ Tiene advertencia en amarillo al final
âœ“ Email de contacto: roomier2024@gmail.com
âœ“ DiseÃ±o con Card elevada
âœ“ Texto legible y bien formateado

SECCIONES A VERIFICAR:
1. AceptaciÃ³n de los TÃ©rminos
2. Elegibilidad
3. Uso de la AplicaciÃ³n
4. Contenido del Usuario
5. Conducta Prohibida
6. VerificaciÃ³n y Seguridad
7. Privacidad de la InformaciÃ³n
8. TerminaciÃ³n de Cuenta
9. LimitaciÃ³n de Responsabilidad
10. Recomendaciones de Seguridad
11. Propiedad Intelectual
12. Modificaciones
13. LegislaciÃ³n Aplicable
14. Contacto

PRUEBA 5B: POLÃTICA DE PRIVACIDAD
----------------------------------
1. Click en "PolÃ­tica de Privacidad"

RESULTADO ESPERADO:
âœ“ Navega a pÃ¡gina de privacidad
âœ“ Muestra 14 secciones numeradas
âœ“ Incluye fecha actualizada
âœ“ Tiene box azul de privacidad al final
âœ“ DiseÃ±o consistente con tÃ©rminos
âœ“ Menciona sistema de privacidad progresiva

SECCIONES A VERIFICAR:
1. IntroducciÃ³n
2. InformaciÃ³n que Recopilamos
3. CÃ³mo Usamos su InformaciÃ³n
4. Sistema de Privacidad Progresiva
5. Compartir InformaciÃ³n
6. Seguridad de Datos
7. Sus Derechos
8. RetenciÃ³n de Datos
9. Menores de Edad
10. Cookies y TecnologÃ­as Similares
11. Transferencias Internacionales
12. Cambios a esta PolÃ­tica
13. Contacto y Preguntas
14. Cumplimiento Legal


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ”„ PRUEBA 6: INTEGRACIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESCENARIO: Flujo completo de usuario con seguridad

PASOS:
1. Registrar nuevo usuario
   âœ“ ContraseÃ±a debe hashearse
   âœ“ Debe recibir token JWT
   
2. Hacer login
   âœ“ ContraseÃ±a debe verificarse contra hash
   âœ“ Debe recibir nuevo token
   
3. Ver home con token
   âœ“ No debe incluir usuarios bloqueados
   
4. Reportar un usuario
   âœ“ Requiere token vÃ¡lido
   âœ“ Reporte se guarda correctamente
   
5. Bloquear un usuario
   âœ“ Usuario desaparece del home
   âœ“ Match mutuo se elimina
   
6. Intentar login 6 veces con contraseÃ±a incorrecta
   âœ“ Se bloquea despuÃ©s de 5 intentos
   
7. Esperar 15 minutos
   âœ“ Rate limit se resetea
   
8. Login exitoso
   âœ“ Funciona normalmente


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ§ª PROPUESTA: TESTS UNITARIOS AUTOMATIZADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTRUCTURA DE TESTS:
/backend/tests/
  â”œâ”€â”€ auth.test.js          - Tests de autenticaciÃ³n
  â”œâ”€â”€ rateLimiter.test.js   - Tests de rate limiting
  â”œâ”€â”€ moderation.test.js    - Tests de reportes/bloqueo
  â”œâ”€â”€ security.test.js      - Tests de seguridad general
  â””â”€â”€ integration.test.js   - Tests de integraciÃ³n

TECNOLOGÃAS SUGERIDAS:
- Jest: Framework de testing
- Supertest: Testing de APIs HTTP
- MongoDB Memory Server: DB en memoria para tests

INSTALACIÃ“N:
> npm install --save-dev jest supertest mongodb-memory-server

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO: auth.test.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const request = require('supertest');
const app = require('../app');
const User = require('../models/user');

describe('Authentication Tests', () => {
  
  describe('POST /api/auth/register', () => {
    it('should hash password with bcrypt', async () => {
      const res = await request(app)
        .post('/api/auth/register')
        .send({
          username: 'testuser',
          password: 'plainpassword',
          email: 'test@test.com',
          birthdate: '2000-01-01'
        });
      
      expect(res.statusCode).toBe(201);
      
      const user = await User.findOne({ username: 'testuser' });
      expect(user.password).not.toBe('plainpassword');
      expect(user.password).toMatch(/^\$2[aby]\$/);
    });
    
    it('should return JWT token on registration', async () => {
      const res = await request(app)
        .post('/api/auth/register')
        .send({
          username: 'testuser2',
          password: 'password',
          email: 'test2@test.com',
          birthdate: '2000-01-01'
        });
      
      expect(res.statusCode).toBe(201);
      expect(res.body).toHaveProperty('token');
      expect(res.body.token).toMatch(/^eyJ/);
    });
  });
  
  describe('POST /api/auth/login', () => {
    it('should verify hashed password correctly', async () => {
      // Primero registrar
      await request(app)
        .post('/api/auth/register')
        .send({
          username: 'logintest',
          password: 'correctpassword',
          email: 'login@test.com',
          birthdate: '2000-01-01'
        });
      
      // Luego hacer login
      const res = await request(app)
        .post('/api/auth/login')
        .send({
          username: 'logintest',
          password: 'correctpassword'
        });
      
      expect(res.statusCode).toBe(200);
      expect(res.body).toHaveProperty('token');
    });
    
    it('should reject incorrect password', async () => {
      const res = await request(app)
        .post('/api/auth/login')
        .send({
          username: 'logintest',
          password: 'wrongpassword'
        });
      
      expect(res.statusCode).toBe(401);
      expect(res.body.error).toContain('invÃ¡lidos');
    });
  });
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO: rateLimiter.test.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

describe('Rate Limiting Tests', () => {
  
  it('should block after 5 failed login attempts', async () => {
    // Intentar login 6 veces
    for (let i = 0; i < 6; i++) {
      const res = await request(app)
        .post('/api/auth/login')
        .send({
          username: 'test',
          password: 'wrong'
        });
      
      if (i < 5) {
        expect(res.statusCode).toBe(401);
      } else {
        expect(res.statusCode).toBe(429);
        expect(res.body.error).toContain('Demasiados intentos');
      }
    }
  });
  
  it('should include rate limit headers', async () => {
    const res = await request(app)
      .post('/api/auth/login')
      .send({
        username: 'test',
        password: 'wrong'
      });
    
    expect(res.headers).toHaveProperty('ratelimit-limit');
    expect(res.headers).toHaveProperty('ratelimit-remaining');
  });
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EJEMPLO: moderation.test.js
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

describe('Moderation Tests', () => {
  let token;
  let userId;
  
  beforeEach(async () => {
    // Crear usuario y obtener token
    const res = await request(app)
      .post('/api/auth/register')
      .send({
        username: 'moderator',
        password: 'pass',
        email: 'mod@test.com',
        birthdate: '2000-01-01'
      });
    
    token = res.body.token;
  });
  
  describe('POST /api/moderation/report', () => {
    it('should create report with valid token', async () => {
      const res = await request(app)
        .post('/api/moderation/report')
        .set('Authorization', `Bearer ${token}`)
        .send({
          reportedUser: 'baduser',
          reason: 'harassment',
          description: 'Test report'
        });
      
      expect(res.statusCode).toBe(201);
      expect(res.body).toHaveProperty('reportId');
    });
    
    it('should reject report without token', async () => {
      const res = await request(app)
        .post('/api/moderation/report')
        .send({
          reportedUser: 'baduser',
          reason: 'harassment'
        });
      
      expect(res.statusCode).toBe(401);
    });
    
    it('should prevent self-reporting', async () => {
      const res = await request(app)
        .post('/api/moderation/report')
        .set('Authorization', `Bearer ${token}`)
        .send({
          reportedUser: 'moderator',
          reason: 'spam'
        });
      
      expect(res.statusCode).toBe(400);
      expect(res.body.error).toContain('ti mismo');
    });
  });
  
  describe('POST /api/moderation/block', () => {
    it('should block user successfully', async () => {
      const res = await request(app)
        .post('/api/moderation/block')
        .set('Authorization', `Bearer ${token}`)
        .send({
          blockedUser: 'baduser'
        });
      
      expect(res.statusCode).toBe(200);
      expect(res.body.blockedUsers).toContain('baduser');
    });
  });
});

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONFIGURACIÃ“N DE JEST (package.json)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "scripts": {
    "test": "jest --watchAll",
    "test:coverage": "jest --coverage"
  },
  "jest": {
    "testEnvironment": "node",
    "coveragePathIgnorePatterns": ["/node_modules/"]
  }
}

EJECUTAR TESTS:
> npm test                  # Modo watch
> npm run test:coverage     # Con coverage report


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ğŸ“Š CHECKLIST DE VERIFICACIÃ“N COMPLETA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SEGURIDAD:
[ ] ContraseÃ±as hasheadas con bcrypt ($2b$10$...)
[ ] JWT tokens generados correctamente
[ ] Tokens incluyen userId y username
[ ] Tokens expiran en 24 horas
[ ] Rate limiting en login (5 intentos/15min)
[ ] Rate limiting en registro (3 intentos/hora)
[ ] Rate limiting en password reset (3 intentos/hora)

MODERACIÃ“N:
[ ] Reportar usuario funciona con token
[ ] Bloquear usuario funciona
[ ] Usuario bloqueado no aparece en home
[ ] Desbloquear usuario funciona
[ ] Ver lista de bloqueados funciona
[ ] Ver mis reportes funciona
[ ] Auto-reporte bloqueado
[ ] Reporte duplicado bloqueado
[ ] Usuarios que te bloquearon no aparecen en home

DOCUMENTACIÃ“N LEGAL:
[ ] PÃ¡gina de TÃ©rminos y Condiciones visible
[ ] PÃ¡gina de PolÃ­tica de Privacidad visible
[ ] Links en pÃ¡gina de login funcionan
[ ] Contenido completo y legible
[ ] DiseÃ±o consistente y profesional

INTEGRACIÃ“N:
[ ] Flujo completo de registro â†’ login â†’ home funciona
[ ] Tokens persisten entre requests
[ ] Rate limits se resetean correctamente
[ ] MongoDB guarda datos correctamente


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    ğŸ¯ PRÃ“XIMOS PASOS RECOMENDADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Implementar tests unitarios automatizados
2. Agregar CI/CD con GitHub Actions
3. Configurar entorno de staging
4. Implementar logging centralizado (Winston)
5. Agregar monitoring (PM2)
6. Configurar backup automÃ¡tico de MongoDB
7. Migrar a MongoDB Atlas (cloud)
8. Implementar S3 para imÃ¡genes
9. Configurar dominio y HTTPS
10. Deploy a servidor de producciÃ³n


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Fin de GuÃ­a de Testing
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
